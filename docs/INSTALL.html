    <HTML> 
	<HEAD> 
	    <TITLE>INSTALL - Slash Installation

</TITLE> 
	</HEAD>

	<BODY>

<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#NAME">NAME</A>
	<LI><A HREF="#SOFTWARE_REQUIREMENTS">SOFTWARE REQUIREMENTS</A>
	<UL>

		<LI><A HREF="#Database_webserver_etc_">Database, webserver, etc.</A>
		<LI><A HREF="#Perl_modules">Perl modules</A>
		<LI><A HREF="#Slash_Code">Slash Code</A>
	</UL>

	<LI><A HREF="#PRE_INSTALLATION_THOUGHTS">PRE-INSTALLATION THOUGHTS</A>
	<LI><A HREF="#INSTALLATION_AND_SETUP">INSTALLATION AND SETUP</A>
	<UL>

		<LI><A HREF="#Running_Slash_on_Multiple_Server">Running Slash on Multiple Servers</A>
		<LI><A HREF="#Database_Upgrades_From_Previous_">Database Upgrades From Previous Versions</A>
		<LI><A HREF="#Upgrade_0_9_2_0_9_3">Upgrade 0.9.2 -> 0.9.3</A>
		<LI><A HREF="#Upgrade_0_9_3_0_9_4">Upgrade 0.9.3 -> 0.9.4</A>
		<LI><A HREF="#Upgrade_0_9_4_0_9_5">Upgrade 0.9.4 -> 0.9.5</A>
		<LI><A HREF="#Upgrade_0_9_5_1_0_0">Upgrade 0.9.5 -> 1.0.0</A>
		<LI><A HREF="#Upgrade_1_0_0_1_0_0_1">Upgrade 1.0.0 -> 1.0.0.1</A>
		<LI><A HREF="#Upgrade_1_0_0_1_1_0_2">Upgrade 1.0.0.1 -> 1.0.2</A>
		<LI><A HREF="#Upgrade_1_0_2_1_0_3">Upgrade 1.0.2 -> 1.0.3</A>
	</UL>

	<LI><A HREF="#AUTHOR">AUTHOR</A>
</UL>
<!-- INDEX END -->

<HR>
<P>
<H1><A NAME="NAME">NAME

</A></H1>
INSTALL - Slash Installation


<P>

<P>
<HR>
<H1><A NAME="SOFTWARE_REQUIREMENTS">SOFTWARE REQUIREMENTS

</A></H1>
Whatever versions listed are the versions recommended. You may try a newer
version, and it should work, but it is not guaranteed (of course, nothing
in here is guaranteed anyway :). Don't try to use anything older than these
listed versions.


<P>

This document is still evolving, so there may be unintended omissions or
various steps may be over- or under-explained. It's assumed that you have
some working experience with some form of Unix, Apache, SQL database, and
perl.


<P>

<STRONG>Note</STRONG>: This page looks best in a browser (the HTML version of it is in the <EM>docs/</EM> directory). You can print it out, but some of the ASCII illustrations may
get munged in printing; however, the directions will certainly appear good
enough to read.


<P>

See the Slash web site, with support, docs, latest downloads, and more, at
<A HREF="http://slashcode.com/.">http://slashcode.com/.</A>


<P>

<P>
<HR>
<H2><A NAME="Database_webserver_etc_">Database, webserver, etc.

</A></H2>
<DL>
<DT><STRONG><A NAME="item_MySQL">MySQL

</A></STRONG><DD>
<PRE>        version 3.22.25
        <A HREF="http://www.mysql.com/">http://www.mysql.com/</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_mod_perl">mod_perl

</A></STRONG><DD>
<PRE>        version 1.21
        <A HREF="http://perl.apache.org/">http://perl.apache.org/</A>
        <A HREF="http://www.perl.com/CPAN/">http://www.perl.com/CPAN/</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_perl">perl

</A></STRONG><DD>
<PRE>        version 5.005_03 (non-threaded)
        <A HREF="http://www.perl.com/CPAN/">http://www.perl.com/CPAN/</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Apache">Apache

</A></STRONG><DD>
<PRE>        version 1.3.6
        <A HREF="http://apache.org/">http://apache.org/</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Sendmail">Sendmail or other mail transport daemon

</A></STRONG><DD>
Refer to your OS distribution.


<P>

<DT><STRONG><A NAME="item_NFS">NFS server (for nfs configuration)

</A></STRONG><DD>
Refer to your OS distribution.


<P>

</DL>
<P>
<HR>
<H2><A NAME="Perl_modules">Perl modules

</A></H2>
<DL>
<DT><STRONG><A NAME="item_DBI">DBI-1.13

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=DBI">http://search.cpan.org/search?dist=DBI</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Data">Data-ShowTable-3.3

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Data-ShowTable">http://search.cpan.org/search?dist=Data-ShowTable</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_TimeDate">TimeDate-1.08

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=TimeDate">http://search.cpan.org/search?dist=TimeDate</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Msql">Msql-Mysql-modules-1.2209

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Msql-Mysql-modules">http://search.cpan.org/search?dist=Msql-Mysql-modules</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_ApacheDBI">ApacheDBI-0.87

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=ApacheDBI">http://search.cpan.org/search?dist=ApacheDBI</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Apache">Apache-DBILogConfig-0.01

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Apache-DBILogConfig">http://search.cpan.org/search?dist=Apache-DBILogConfig</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Apache">Apache-DBILogger-0.93

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Apache-DBILogger">http://search.cpan.org/search?dist=Apache-DBILogger</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_libnet">libnet-1.0607

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=libnet">http://search.cpan.org/search?dist=libnet</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_HTML">HTML-Parser-2.25

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=HTML-Parser">http://search.cpan.org/search?dist=HTML-Parser</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_XML">XML-Parser-2.27

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=XML-Parser">http://search.cpan.org/search?dist=XML-Parser</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_MIME">MIME-Base64-2.11

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=MIME-Base64">http://search.cpan.org/search?dist=MIME-Base64</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Digest">Digest-MD5-2.09

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Digest-MD5">http://search.cpan.org/search?dist=Digest-MD5</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_URI">URI-1.04

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=URI">http://search.cpan.org/search?dist=URI</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_libwww">libwww-perl-5.47

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=libwww-perl">http://search.cpan.org/search?dist=libwww-perl</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_DateManip">DateManip-5.35

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=DateManip">http://search.cpan.org/search?dist=DateManip</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_File">File-Spec-0.8

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=File-Spec-0.8">http://search.cpan.org/search?dist=File-Spec-0.8</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Mail">Mail-Sendmail-0.77

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Mail-Sendmail">http://search.cpan.org/search?dist=Mail-Sendmail</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Compress">Compress-Zlib-1.08

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Compress-Zlib">http://search.cpan.org/search?dist=Compress-Zlib</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Image">Image-Size-2.901

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Image-Size">http://search.cpan.org/search?dist=Image-Size</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_Storable">Storable-0.6.9

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=Storable">http://search.cpan.org/search?dist=Storable</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_ipc_shareable">ipc_shareable-0.30

</A></STRONG><DD>
<PRE>        <A HREF="http://search.cpan.org/search?dist=ipc_shareable">http://search.cpan.org/search?dist=ipc_shareable</A>
</PRE>

<P>

<STRONG>Note</STRONG>: IPC::Shareable is only needed for the troll speed limit feature, which is
off by default (settable via the <CODE>use_ipc</CODE>
variable in <EM>slashdotrc.pl</EM>). Also, on all of our test systems, some of the tests in <CODE>make test</CODE> failed, but the module seems to work fine for our purposes regardless.


<P>

</DL>
<P>
<HR>
<H2><A NAME="Slash_Code">Slash Code

</A></H2>
<PRE>        Bundle/Slash.pm
        Slash.pm
        slashd
        moderatord
        portald
        dailyStuff
        public_html/index.pl
        public_html/comments.pl
        public_html/article.pl
        public_html/admin.pl
        public_html/hof.pl
        public_html/cheesyportal.pl
        public_html/authors.pl
        public_html/metamod.pl
        public_html/nominate.pl
        public_html/pollBooth.pl
        public_html/search.pl
        public_html/sections.pl
        public_html/submit.pl
        public_html/topics.pl
        public_html/users.pl
        public_html/404.pl
        public_html/imagesize.pm
</PRE>

<P>

You can get the Slash code in these locations:


<P>

<DL>
<DT><STRONG><A NAME="item_FTP">FTP

</A></STRONG><DD>
<PRE>        <A HREF="ftp://ftp.slashdot.org//pub/slash/">ftp://ftp.slashdot.org//pub/slash/</A>
</PRE>

<P>

<DT><STRONG><A NAME="item_HTTP">HTTP, CVS

</A></STRONG><DD>
<PRE>        <A HREF="http://sourceforge.net/project/?group_id=4421">http://sourceforge.net/project/?group_id=4421</A>
</PRE>

<P>

The CVS repository is tagged with versions, so to get release 1.0.3, get
tag v1_0_3_0. The last number will be incremented during development
(v1_0_3_1, v1_0_3_2, etc.) until the next release.


<P>

</DL>
<P>
<HR>
<H1><A NAME="PRE_INSTALLATION_THOUGHTS">PRE-INSTALLATION THOUGHTS

</A></H1>
The are several configurations recommended, depending on scale.


<P>

<DL>
<DT><STRONG><A NAME="item_Single">Single server (all on one box)

</A></STRONG><DD>
<PRE>        Server 1
        +-------------------+
        |  slash    db      |
        |  apache/mod-perl  |
        |  slash    code    |
        +-------------------+
</PRE>

<P>

<DT><STRONG><A NAME="item_db">db and code on one server, and external webserver

</A></STRONG><DD>
<PRE>        server 1                                       server 2 .. n
        +-----------------+                           +-----------+
        | slash    db     |                           |           |
        | apache/mod-perl |---- NFS or exact copy ----| Webserver |
        | slash    code   |---- NFS or exact copy ----|           |
        +-----------------+                           +-----------+
                   |_________________ DBI __________________|
</PRE>

<P>

<DT><STRONG>db separate on one server, slashdot code and apache on another,
exported to web servers

</A></STRONG><DD>
<PRE>        server 1                server2                               server 3 .. n
        +-----------+     +-----------------+                         +-----------+
        | slash db  |     |                 |                         |           |
        |           |     | apache/mod-perl |--- NFS or exact copy ---| Webserver |
        |           |     | slash    code   |--- NFS or exact copy ---|           |
        +-----------+     +-----------------+                         +-----------+
              |______ DBI _________|_______________________________________|
</PRE>

<P>

</DL>
There are many ways this can be done. The key is to think about how the
site will be put together before starting the installation.


<P>

<P>
<HR>
<H1><A NAME="INSTALLATION_AND_SETUP">INSTALLATION AND SETUP

</A></H1>
Perform these tasks as root.


<P>

<OL>
<LI><STRONG><A NAME="item_">

</A></STRONG>
Create the group ``slash''.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Create the user ``slash'' with slashdot gid. <STRONG>Note</STRONG>: if using multiple webservers, and using NFS, make sure that this
user:group is created with the same UID and GID on all involved systems.


<P>

<STRONG>Note</STRONG>: For security's sake, you may wish to add the web server user (e.g.,
``nobody'') to the ``slash'' group, and then set your permissions so that
all the files are writable by user and group and not world, to keep other
users on the system from modifying the files.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Unpack the slash code tarball in the slash user's home directory. This will
place everything where it should belong.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
chown everything in this tree as slash:slash (i.e., <CODE>chown -R
slash:slash /home/slash</CODE>). chmod the main directory to be readable and executable by all (i.e., <CODE>chmod a+rx /home/slash</CODE>).


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Create the directory apache will be installed into (i.e.,
<EM>/usr/local/apache</EM>). The default install uses a separate directory for apache logs, which
should also be created as
<EM>/usr/local/apache_logs</EM>. Alternatively, change <EM>httpd.conf</EM> to point to a different location. See the section below on installing perl
modules for more information about the default installation.


<P>

Multiple slash instances can run under virtual hosts on the same httpd. See <EM>vhost.httpd.conf</EM> for an example of how this works. Pay special attention to the
configuration section under the text ``# MAIN SLASHCODE SPECIFIC STUFF
STARTS HERE #''.


<P>

For virtual hosts, you should create a separate account and Slash
installation for each virtual host, so repeat the instructions relating to
creation of accounts for each virtual host.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Install MySQL. Please refer to MySQL documentation for compilation and/or
installation notes for any questions with this. Find the script that runs
mysql (probably <EM>safe_mysqld</EM>) and add this to the beginning of it:


<P>

<PRE>        TZ=GMT
        export TZ
</PRE>

<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Create the slash mysql user and database.


<P>

<PRE>        mysql mysql &lt; sql/slashdb_create.sql
</PRE>

<P>

This will create both the slash db user and slash db. If you are using
virtual hosts, or want to otherwise change the db user or db name, edit
this script before running it to use the proper db user and db name. This
script creates the user slash with the password ``changethis''. Immediately
change the password for slash in mysql:


<P>

<PRE>        mysql mysql
        update user set Password = password('newpassword') where User = 'slash';
        flush privileges;
</PRE>

<P>

<STRONG>Note</STRONG>: The slash db user is created with several privileges such as drop and
create table, so it's up to you to modify those privileges to something
more restrictive if you feel uncomfortable with these settings. We'd
suggest you don't let other users on the database have access to this user.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Run the slash schema creation script and load sample slash db data dump.
This dump has minimal data for the system to work. This data is needed in
the database for the site to work at all. It has a very plain, basic
design, that has a lot of HTML comments in each block to give an idea of
how the site works. Other data in this dump is tables that the system needs
to do things such as time conversion for user date format strings. Please
refer to the database schema and database schema documentation to
understand how the database schema works.


<P>

Replace <CODE>HOSTNAME</CODE> (or <CODE>HOSTNAME:PORT</CODE>) below with the server's hostname (this is the name you will call the
server in the browser, used for default links in the HTML).


<P>

<PRE>        cd sql
        mysql -uslash -pnewpassword slash &lt; slashschema_create.sql
        ./predata_dump.pl HOSTNAME
        mysql -uslash -pnewpassword slash &lt; slashdata_dump.sql
        mysql -uslash -pnewpassword slash &lt; slashdata_prep.sql
</PRE>

<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Install perl.


<P>

On Slashdot and Slashcode, we have all of the modules installed in the
Apache directory, so that we can NFS mount that one directory on several
machines, and they all have the same modules and configuration. If you want
to do that, when the configuration process asks where you want to put perl
modules (both system and local) have it put them in the directory tree
you'll install apache in (i.e., <EM>/usr/local/apache/lib</EM>). Otherwise, the default installation directories are usually fine.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Untar apache and mod_perl. Build mod_perl. Have its build process build and
install apache for you:


<P>

<PRE>        perl Makefile.PL APACHE_SRC=/where_you_have_the_source DO_HTTPD=1 \
                USE_APACI=1 PERL_MARK_WHERE=1 EVERYTHING=1 \
                APACHE_PREFIX=/where_apache_will_be_installed
        make
        make test
        make install
</PRE>

<P>

This will install both mod_perl and apache.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Install the listed perl modules in the order listed in <A HREF="#Perl_Modules">Perl Modules</A>. You can use CPAN if you want, or ftp, untar and do it yourself. Use
whichever does the job.


<P>

Note that the module versions Slash has been tested with are given; use
other versions at your own risk. We actually think that the current version
of each module as of this note will work, so if you are brave, go ahead and
install the latest.


<P>

You can get the files via FTP yourself from CPAN and then install each by
hand, or, if you can get the CPAN module running, you can use that. There
are several ways to use the CPAN shell to install modules. You can install
each one individually:


<P>

<PRE>        perl -MCPAN -e shell
        # some configuration / initialization stuff
        &gt; install DBI
</PRE>

<P>

Or, you can install all of them at once using the Bundle::Slash module.
This method is the easiest, but if something does not work right, it can be
more of a pain to track it down.


<P>

<PRE>        cd /home/slash
        perl -MCPAN -e &quot;install 'Bundle::Slash'&quot;
</PRE>

<P>

You may also want to use CPAN shell to install Bundle::libnet, Bundle::LWP,
Bundle::DBI, Bundle::DBD::mysql, and then the rest of the modules. See the
manpage <EM>perlmodinstall</EM> for more information about using CPAN and installing modules.


<P>

<STRONG>Note</STRONG>: Compress::Zlib is now required, and it won't install properly if the zlib
development headers are not available. See the documentation for
Compress::Zlib for more information.


<P>

<STRONG>Note</STRONG>: File::Spec is now required, but a version beyond what comes with perl
5.00503 is required. Use `make install UNINST=1` to remove the version that
comes with perl while installing the new version. Even if using the CPAN
shell you can do this:


<P>

<PRE>        cpan&gt; test <A HREF="File::Spec">File::Spec</A>     # download, make, and test
        cpan&gt; look <A HREF="File::Spec">File::Spec</A>     # opens shell to proper dir
        % make install UNINST=1   # install from shell
</PRE>

<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Copy the slash httpd.conf from the untarred slash code tarball's directory
httpd (i.e., <EM>/home/slash/httpd/httpd.conf</EM>) to apache's conf directory. Take time to look over the file to make sure
that it matches your site's specific setup. Similarly edit
<EM>/home/slash/slashdotrc.pl</EM>.


<P>

For <EM>httpd.conf</EM>, pay close attention to directories and to the number of servers and the
max clients and requests. The defaults are similar to Slashdot's defaults,
but most sites will not need 20 servers with over 100 maximum requests per
child process.


<P>

In <EM>slashdotrc.pl</EM>, make sure you have reasonable defaults for everything. If you are
upgrading, then you will likely want to make a copy of your old <EM>slashdotrc.pl</EM> and copy those values into the new file, since it is subject to change
significantly from one release to the next.


<P>

If your web server is inside a firewall, you may wish to set the basedomain
variable to ``'', so all links will be relative to <EM>/</EM>.


<P>

If you are doing virtual hosting for multple Slash sites, see the
instructions at the bottom of <EM>slashdotrc.pl</EM> and the sample configuration at the bottom of <EM>httpd.conf</EM>.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Create <EM>/etc/apache.listen</EM> (where <CODE>MY.IP.ADD.RESS</CODE> is the IP address Apache will be listening on):


<P>

<PRE>        echo &quot;Listen MY.IP.ADD.RESS:80&quot; &gt; /etc/apache.listen
</PRE>

<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Start apache.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Copy the slashd startup script from the Slash source directory (i.e.
<EM>/home/slash/utils</EM>) slashd into the init.d directory (<EM>/etc/init.d</EM>
on Debian). Chown it to the slash user (i.e., <CODE>chown slash:slash /etc/init.d/slashd</CODE>) and then chmod it u+s and g+s (i.e., <CODE>chmod u+s /etc/init.d/slashd</CODE>,
<CODE>chmod g+s /etc/init.d/slashd</CODE>) Create all the links to this file for the various run levels. Note: this
script is a startup script, and is not the same script as the
<EM>slashd</EM> in the same directory as <EM>Slash.pm</EM>.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Start slashd with the startup script (i.e., <CODE>/etc/init.d/slashd
start</CODE>).


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Log into the server administration.


<P>

<PRE>        <A HREF="http://whateveryoursiteiscalled.com/admin.pl">http://whateveryoursiteiscalled.com/admin.pl</A>
</PRE>

<P>

The admin user/password is God/pete (you'll need to change this).


<P>

This page allows you to approve submissions to be run as stories, add new
stories, edit stories, edit the blocks of html, code, and variables that
control the look and feel of the site.


<P>

The system has 7 users:


<P>

<PRE>        author1
        author2
        Anonymous Coward
        user1
        user2
        user3
        user4
</PRE>

<P>

The passwords are all ``change''. As that implies, you should change it.
It's clear text, so simply change it via the database, although you can use
the server administration, too. If you do not change all your passwords,
you almost certainly will get haX0rD.


<P>

<PRE>        mysql -uslash -pslashpass slash
</PRE>

<P>

Then for each author:


<P>

<PRE>        update authors set pwd='newpassword' where aid='authorname';
</PRE>

<P>

And for each user:


<P>

<PRE>        update users set passwd='newpassword' where nickname='username';
</PRE>

<P>

You can see all of the authors and users with these:


<P>

<PRE>        select aid,pwd from authors;
        select nickname,passwd from users;
</PRE>

<P>

</OL>
<P>
<HR>
<H2><A NAME="Running_Slash_on_Multiple_Server">Running Slash on Multiple Servers

</A></H2>
<OL>
<LI><STRONG><A NAME="item_">

</A></STRONG>
Make sure that each of those servers has an EXACT copy of the entire apache
tree (modules and all).


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Either remote copy recursively, or simply export the entire apache tree via
NFS (read-only) to the servers you intend to be the web servers.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Make sure that whatever box is running slashd has all of its code and
static documents exported to those web servers as well (read-only).


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Make sure that the slash user in mysql can access the database from any
host that has the code on it:


<P>

<PRE>        mysql mysql
        insert into user values
        ('webserver1','slash',password('newpassword'),'Y','Y','Y','Y','Y','N','N','N','Y','Y','Y','Y','Y','Y');
        insert into user values
        ('webserver2','slash',password('newpassword'),'Y','Y','Y','Y','Y','N','N','N','Y','Y','Y','Y','Y','Y');
        insert into user values
        ('webserver3','slash',password('newpassword'),'Y','Y','Y','Y','Y','N','N','N','Y','Y','Y','Y','Y','Y');
        insert into user values
        ('webserverN','slash',password('newpassword'),'Y','Y','Y','Y','Y','N','N','N','Y','Y','Y','Y','Y','Y');
        flush privileges;
</PRE>

<P>

</OL>
<P>
<HR>
<H2><A NAME="Database_Upgrades_From_Previous_">Database Upgrades From Previous Versions

</A></H2>
Slash is data. When we release a new version, it often has updates to the
database, too. As such, updates can be difficult.


<P>

We have provided upgrade scripts from previous versions of slash. Each
script upgrades from the version immediately preceding it, so 0.9.2 users,
to upgrade to 0.9.5, would need to run the 0.9.3 scripts, then the 0.9.4
scripts, then the 0.9.5 scripts.


<P>

The scripts are stored in <EM>sql/updates/x.x.x/</EM>, where <EM>x.x.x</EM> is the version to upgrade to. The <EM>.sql</EM> scripts can be run like so:


<P>

<PRE>        mysql -uslash -pslashpass slash &lt; updatescript.sql
</PRE>

<P>

The Perl scripts should be run, however, from the main slash directory, so
all of the libraries can be found:


<P>

<PRE>        cd /home/slash
        ./sql/updates/0.9.5/updatescript.pl
</PRE>

<P>

You may also at some point choose to reinitialize the database from
scratch. For that, you can do something like this:


<P>

<PRE>        mysql mysql
        mysql&gt; drop database slash;
        mysql&gt; create database slash;
        mysql&gt; quit
</PRE>

<P>

<PRE>        cd sql
        mysql -uslash -pslashpass slash &lt; slashschema_create.sql
        mysql -uslash -pslashpass slash &lt; slashdata_dump.sql
        mysql -uslash -pslashpass slash &lt; slashdata_prep.sql
</PRE>

<P>

<P>
<HR>
<H2><A NAME="Upgrade_0_9_2_0_9_3">Upgrade 0.9.2 -> 0.9.3

</A></H2>
If you have already installed slash-0.9.2, you may use the
<EM>alter_database.sql</EM> script to update the database, then run
<EM>blocks_update.pl</EM> (make sure you change the connect string) if you don't want to start your
database over from scratch. However, the blocks table contains a lot of
updated data in slash-0.9.3 that must be fixed in order for slash-0.9.3 to
work at all: global variables in the blocks (like <CODE>$rootdir</CODE> and
$fg[2]) must be changed to the new style ($I{rootdir} and $I{fg}[2]}). You
can do this by hand, or use the dumped data in <EM>slashblocks_dump.sql</EM>.


<P>

<P>
<HR>
<H2><A NAME="Upgrade_0_9_3_0_9_4">Upgrade 0.9.3 -> 0.9.4

</A></H2>
The tables <STRONG>blocks</STRONG> and <STRONG>sectionblocks</STRONG> needed to be fixed to make it so that they had a 1:1 correlation on every
record for the admin interface to be able to work correctly. There was a
bad mismatch between the two tables. We've added processes to help upgrade
for those that have put a lot of work into customizing their sites and
don't want to lose any of their work. First, back up the blocks table by
doing a dump, or simply back up individual blocks by doing the following:


<P>

<OL>
<LI><STRONG><A NAME="item_">

</A></STRONG>
Check to see that your block has an entry in both <STRONG>blocks</STRONG> and
<STRONG>sectionblocks</STRONG> in the case the <EM>admin.pl</EM> didn't get it in there properly:


<P>

<PRE>        select count(*) from blocks where bid = 'myownblock';
        select count(*) from sectionblocks where bid = 'myownblock';
</PRE>

<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
If there's only one of the <STRONG>bid</STRONG>s in either record, you can insert an entry by hand for that record as
shown here.


<P>

If it is blocks that it's missing from, for a static block:


<P>

<PRE>        insert into blocks values ('myownblock','','',500,'',NULL);
</PRE>

<P>

For a portal block (something that's fetched via portald):


<P>

<PRE>        insert into blocks values ('myownblock','','',500,'portald',NULL);
</PRE>

<P>

If it is sectionblocks that it's missing from:


<P>

<PRE>        insert into sectionblocks values ('','myownblock',0,'',0,NULL,NULL,0);
</PRE>

<P>

If there are more than one record for a bid in <STRONG>sectionblocks</STRONG>, delete one of them (probably the one without a <STRONG>section</STRONG>).


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
If you want to back up a specific block, try something like:


<P>

<PRE>        select * from blocks where bid = 'myownblock' into outfile '/tmp/blocks.myownblock.txt';
        select * from sectionblocks where bid = 'myownblock' into outfile '/tmp/blocks.myownblock.txt';
</PRE>

<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Run the sql script <EM>blocks_fix.sql</EM>. This script makes sure every record has a match in each table, and also
modifies the <STRONG>bid</STRONG> column in
<STRONG>sectionblocks</STRONG> to be the same as it is in blocks, as well as some other fixes to some of
the blocks:


<P>

<PRE>        mysql -uslash -pslashpass &lt; blocks_fix.sql
</PRE>

<P>

Keep note of any errors you might see. On a new 0.9.3 distribution,
untouched, unmodified data, this worked without incident.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
Run the sql script <EM>blocks_alter.sql</EM>. This script drops the existing primary key on <STRONG>sectionblocks</STRONG>, which is a combination of <STRONG>bid</STRONG> and
<STRONG>section</STRONG>, and creates a new primary key on <STRONG>bid</STRONG> (which prevents duplicates of the same <STRONG>bid</STRONG>).


<P>

<PRE>        mysql -uslash -pslashpass &lt; blocks_alter.sql
</PRE>

<P>

If this gives you an error, it is most likely due to the fact that there
are duplicate <STRONG>bid</STRONG>s in <STRONG>sectionblocks</STRONG>. Identify those records and delete the extra one, then retry this script.
All block ids (<EM>bid</EM>) must be unique.


<P>

<LI><STRONG><A NAME="item_">

</A></STRONG>
If you deleted any of the blocks that you backed up as show in step 3, you
can restore those blocks this way:


<P>

<PRE>        load data infile '/tmp/blocks.myownblock.txt' INTO TABLE blocks;
        load data infile '/tmp/sectionblocks.myownblock.txt' INTO TABLE sectionblocks;
</PRE>

<P>

</OL>
<P>
<HR>
<H2><A NAME="Upgrade_0_9_4_0_9_5">Upgrade 0.9.4 -> 0.9.5

</A></H2>
Just run the scripts in the <EM>sql/updates/0.9.5/</EM> directory. The scripts
<EM>blocks_backup.sql</EM> and <EM>fix_matchname.pl</EM> will update the data and structure of the database, and everyone should run
them. The script
<EM>blocks_update.sql</EM> should only be run by people who want some of their blocks data changed.
Examine the script and CHANGES and determine if you want to run the script,
or whatever.


<P>

<P>
<HR>
<H2><A NAME="Upgrade_0_9_5_1_0_0_Just_run_">Upgrade 0.9.5 -> 1.0.0
Just run the script update_db-1.0.0.sql in the <EM>sql/updates/1.0.0/</EM> directory, and
make sure you have the latest code.

</A></H2>
<P>
<HR>
<H2><A NAME="Upgrade_1_0_0_1_0_0_1_Just_ru">Upgrade 1.0.0 -> 1.0.0.1
Just run the script update_db-1.0.0.1.sql in the <EM>sql/updates/1.0.0.1/</EM>
directory, and make sure you have the latest code.

</A></H2>
<P>
<HR>
<H2><A NAME="Upgrade_1_0_0_1_1_0_2_Just_ru">Upgrade 1.0.0.1 -> 1.0.2
Just run the script update_db-1.0.2.sql in the <EM>sql/updates/1.0.2/</EM>
directory, and make sure you have the latest code.

</A></H2>
<P>
<HR>
<H2><A NAME="Upgrade_1_0_2_1_0_3_Just_run_">Upgrade 1.0.2 -> 1.0.3
Just run the script formkeys.sql in the <EM>sql/updates/1.0.2/</EM>
directory, and make sure you have the latest code.  Note that the
commentkey table is no longer used; feel free to delete if you want to.

</A></H2>
<P>
<HR>
<H1><A NAME="AUTHOR">AUTHOR

</A></H1>
Patrick Galbraith and Chris Nandor. Last Modified May 16, 2000.

<P>

</DL>
    </BODY>

    </HTML>
