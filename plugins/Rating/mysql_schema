CREATE TABLE comment_vote (
	vote_id mediumint UNSIGNED NOT NULL auto_increment,
	uid mediumint UNSIGNED NOT NULL,
	ipid char(32) DEFAULT '' NOT NULL,
	discussion mediumint UNSIGNED NOT NULL,
	cid mediumint UNSIGNED NOT NULL,
	val tinyint DEFAULT '0' NOT NULL,
	active ENUM("no", "yes") DEFAULT "yes" NOT NULL,
	ts DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00',
	PRIMARY KEY vote_id (vote_id),
	KEY uid_discussion_cid (uid,discussion,cid),
	KEY ipid_discussion_cid (ipid,discussion,cid),
	KEY cid (cid),
	KEY discussion_active_val (discussion, active, val),
	KEY ts (ts)
);

CREATE TABLE discussion_rating (
	discussion mediumint UNSIGNED NOT NULL UNIQUE,
	total_votes mediumint NOT NULL DEFAULT 0,
	active_votes mediumint NOT NULL DEFAULT 0,
	avg_rating float DEFAULT NULL,
	PRIMARY KEY (discussion)
);

