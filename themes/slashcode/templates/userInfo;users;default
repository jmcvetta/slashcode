__section__
default
__description__
Display user's info

* title = passed to titlebar
* useredit = hashref of info of the user being viewed
* points = available moderation points
* commentstruct = arrayref of comments
* nickmatch_flag = current user is same as viewed user
* mod_flag = is moderator
* karma_flag = boolean for display karma
* admin_block = admin stuff
* admin_flag = boolean for whether to display admin stuff
* fieldkey = the field key used to decide what we're looking at
* reasons = hashref from $slashdb->getReasons()

__title__

__page__
users
__lang__
en_US
__name__
userInfo
__template__
[% USE Slash %]
[% PROCESS user_titlebar tab_selected='info' %]
[% IF form.formkey %]
        <!-- INPUT TYPE="HIDDEN" NAME="formkey" VALUE="[% form.formkey %]" -->
[% END %]

[% IF nickmatch_flag %]

<P>This is <B>your</B> User Info page.  There are thousands more, but
this one is yours.  You most likely are not so interested in yourself,
and probably would be more interested in the Preferences links you see
up top there, where you can customize [% constants.sitename %],
change your password, or just click pretty widgets to kill time.

[% IF mod_flag %]
<P>You're a moderator with [% points %] point[% points == 1 ? '' : 's' %]
[%- IF points && useredit.points_expire %] (expire on [% useredit.points_expire %])[% END %].
Please read the
<A HREF="[% constants.rootdir %]/moderation.shtml">Moderator Guidelines</A>
before you do any moderation.<BR><P>
[% END %]
[% IF ! useredit.registered %]
<P>This account is currently expired. Please <A HREF="[% constants.rootdir %]/users.pl?op=validateuser">re-register</A> at your earliest opportunity.<BR><P>
[% END %]

<P><HR></P>

[% END %]

[% IF admin_flag %]
[% admin_block %]
[% END %]

<BR>
[% IF useredit.homepage %]
<A HREF="[% useredit.homepage %]">[% useredit.homepage | strip_literal %]</A><BR>
[% END; IF useredit.fakeemail %]
<A HREF="mailto:[% useredit.fakeemail | fixparam %]">[% useredit.fakeemail | strip_literal %]</A><BR>
[% END; IF useredit.journal_last_entry_date.search('[1-9]') %]
<A HREF="[% constants.rootdir %]/~[% useredit.nick_plain | fixparam %]/journal/">
Last Journal Entry was [% Slash.timeCalc(useredit.journal_last_entry_date) %]</A>
[ <A HREF="[% constants.rootdir %]/journal.pl?op=list&amp;uid=[% useredit.uid %]">List</A> ]
<BR>
[% END %]
[% IF karma_flag && (admin_flag || nickmatch_flag)  %]
	<B>Karma:</B>
	[% IF constants.karma_obfuscate;
		FOREACH score = constants.karma_adj.keys.nsort;
			IF useredit.karma <= score;
				constants.karma_adj.$score;
				IF admin_flag;
					" ("; useredit.karma; ") ";
				END;
				" (mostly affected by moderation done to your comments)";
				LAST;
			END;
		END;
	ELSE;
		useredit.karma; "  (mostly the sum of moderation done to your comments)";
	END; %]<BR>
[% END %]

[% IF useredit.bio %]
 <B>User Bio</B>
 <BR>[% Slash.parseDomainTags(useredit.bio, useredit.fakeemail) | strip_html %]<BR>
[% END %]

<BR>
[% IF commentcount > 0 %]
[% commenttitle = "$useredit.nickname's Latest $commentstruct.size of $commentcount Comment" %]
[% IF commentcount > 1; commenttitle = commenttitle _ 's'; END %]
[% PROCESS titlebar width="100%" title = commenttitle %]
[% ELSE %]
<B>useredit.nickname has yet to post any comments.</B>
[% END %]
<P>

[% n = min_comment %]
[% FOREACH comment = commentstruct;

	n = n + 1;
	replies = comment.replies ? 'Replies:' _ comment.replies _ '; ' : '';
	score = 'Score:' _ comment.pts;
	reasonnum = comment.reason;
	reasontext = reasonnum ? ', ' _ reasons.$reasonnum.name : '';
	IF comment.type == 'poll';
		label = 'Poll: ';
	ELSIF comment.type == 'journal';
		label = 'Journal Discussion: ';
	ELSE;
		label = '';
	END;
	label = label _ comment.disc_title;

	'<BR><B>'; n; '</B> ';
	'<A HREF="';
		constants.rootdir;
		'/comments.pl?sid='; comment.sid;
		'&amp;cid='; comment.cid;
	'">';
	comment.subj;
	'</A> posted on ';
	comment.cdate;
	' ('; replies; score; reasontext; ') ';
	'<FONT SIZE="2">';
		'<BR>attached to <A HREF="';
			comment.url;
		'">'; label; '</A>';
	'</FONT>';

END %]

[% IF admin_flag && commentcount > n %] 
<P><A HREF="[% constants.rootdir %]/users.pl?op=userinfo&amp;nick=[% useredit.nick_plain | fixparam %]&amp;min_comment=[% n %]"
>More Comments...</A><P>
[% END %]

[% IF admin_flag %]
	<P><TABLE BORDER=0 ALIGN="CENTER">
	<TR><TD ALIGN="CENTER">Moderations performed by [% useredit.nickname %]:</TD></TR>
	<TR><TD ALIGN="CENTER">[% Slash.moderatorCommentLog('uid', useredit.uid) %]</TD></TR>
	<TR><TD ALIGN="CENTER">&nbsp;<BR>Moderations performed on [% useredit.nickname %]'s comments:</TD></TR>
	<TR><TD ALIGN="CENTER">[% Slash.moderatorCommentLog('cuid', useredit.uid) %]</TD></TR>
	</TABLE>
[% END %]

[% IF stories %]
<P>
[% IF storycount > constants.user_submitter_display_default;
	storytitle = $useredit.nickname _ "'s Latest " _ $form.min _ ' Accepted Stories';
ELSE;
	storytitle = $useredit.nickname _ "'s " _ $storycount _ 'Accepted Stor';
	IF storycount > 1;
		storytitle = storytitle _ 'ies';
	ELSE;
		storytitle = storytitle _ 'y';
	END;
END; %]
[% PROCESS titlebar width = "100%" title = storytitle %]
<P>
[% n = 0 %]
[% FOREACH story = stories %]
        [% n = n + 1 %]
                <A HREF="[% constants.rootdir %]/article.pl?sid=[% story.sid %]">[% story.title %]</A> on [% Slash.timeCalc(story.time) %]<BR>
[% END %]
[% END %]

__seclev__
500
